% cjupiter-c3-nary-digraph.tex

\documentclass{standalone}
\input{jupiter-illustration-preamble}

\begin{document}
\begin{tikzpicture}[bg/.style = {rectangle, draw, very thick}]
  \statesplit{\{\}}{\epsilon}{}{0}
  \statesplit{1}{x}{below = of 0}{1}
  \transition{0}{1}{1: \ins{x}{1}}
  \statesplit{12}{\epsilon}{below left = of 1}{12}
  \statesplit{13}{ax}{below right = of 1}{13}
  \statesplit{123}{a}{below = 2.1*\vdist of 1}{123}
  \transition{1}{12}{2: \del{x}{1}}
  \transition{1}{13}{3: \ins{a}{1}}
  \transition{12}{123}{3: \ins{a}{1}}
  \transition{13}{123}{2: \del{x}{2}}
  \statesplit{14}{xb}{right = 1.5*\vdist of 13}{14}
  \transition{1}{14}{4: \ins{b}{2}}

  \statesplit{124}{b}{right = 2.1*\hdist of 123}{124}
  \transition{14}{124}{2: \del{x}{1}}
  \transition[near end]{12}{124}{4: \ins{b}{1}}
  
  \statesplit{1234}{ba}{below = 2*\vdist of 13}{1234}
  \transition{124}{1234}{3: \ins{a}{2}}
  \transition{123}{1234}{4: \ins{b}{1}}

  \node () [fit = (0) (1) (12) (13) (123) (14) (124) (1234), bg] {};

  \node () [draw, red, rotate fit = 50, fit = (1to13) (13) (13to123), 
    inner sep = 10pt,
    rectangle, rounded corners, dashed, ultra thick] {};
\end{tikzpicture}
\end{document}
